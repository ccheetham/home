# =============================================================================
# Docker
# -----------------------------------------------------------------------------
# https://www.docker.com/
# =============================================================================

alias d='docker'
alias d\?='d help'

# -----------------------------------------------------------------------------
# dman: convenience for 'man docker-CMD'
# -----------------------------------------------------------------------------
dman () {
    if [[ $# != 1 ]] ; then
        echo specify one and only one docker command >&2
        return 1
    fi
    man docker-$1
}

# -----------------------------------------------------------------------------
# dbash: run image interactively via bash (or other command)
# -----------------------------------------------------------------------------
dbash () {
    local image
    local args
    if [[ $# == 0 ]] ; then
        echo docker image not specified >&2
        return 1
    fi
    image=$1 ; shift
    [[ $# == 0 ]] && args=bash || args=$@
    docker run -it --rm $image $args
}

# -----------------------------------------------------------------------------
# drmx: remove exited containers
# -----------------------------------------------------------------------------
drmx () {
    docker ps --quiet --filter status=exited | xargs docker rm
}

# -----------------------------------------------------------------------------
# dtags: list image tags
# -----------------------------------------------------------------------------
dtags () {
    local image
    local tags
    if [[ $# != 1 ]] ; then
        echo specify one and only one docker image >&2
        return 1
    fi
    image=$1
    tags=$(wget -q -O- https://registry.hub.docker.com/v2/repositories/library/$image/tags)
    if [[ $? != 0 ]] ; then
        echo "no tags for $image" >&2
        return 1
    fi
    python - <<EOF
import json
tags = [t['name'] for t in json.loads('''$tags''')['results']]
tags.sort()
for tag in tags:
    print "{}:{}".format('$image', tag)
EOF
}

# vim: ft=zsh
